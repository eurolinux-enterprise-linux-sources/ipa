From 6b7f583588a8cec55319191b1cd64286b4e3675c Mon Sep 17 00:00:00 2001
From: Ana Krivokapic <akrivoka@redhat.com>
Date: Tue, 9 Apr 2013 12:46:01 +0200
Subject: [PATCH 80/98] Remove HBAC source hosts from web UI

https://fedorahosted.org/freeipa/ticket/3528
---
 install/ui/hbac.js         | 67 ----------------------------------------------
 install/ui/hbactest.js     | 24 -----------------
 ipalib/plugins/internal.py |  3 ---
 3 files changed, 94 deletions(-)

diff --git a/install/ui/hbac.js b/install/ui/hbac.js
index 63c928aab495f27b2e8e5fe072fdf105625d9e5d..7fd99ff13544b3b01214aaa6892debdeb849ed26 100644
--- a/install/ui/hbac.js
+++ b/install/ui/hbac.js
@@ -466,73 +466,6 @@ IPA.hbacrule_details_facet = function(spec) {
         }
     );
 
-    //
-    // Source host
-    //
-
-    spec.fields.push(
-        {
-            type: 'radio',
-            name: 'sourcehostcategory',
-            widget: 'sourcehost.rule.sourcehostcategory'
-        },
-        {
-            type: 'rule_association_table',
-            name: 'sourcehost_host',
-            widget: 'sourcehost.rule.sourcehost_host',
-            priority: IPA.hbac.remove_method_priority
-        },
-        {
-            type: 'rule_association_table',
-            name: 'sourcehost_hostgroup',
-            widget: 'sourcehost.rule.sourcehost_hostgroup',
-            priority: IPA.hbac.remove_method_priority
-        }
-    );
-
-    spec.widgets.push(
-    {
-            factory: IPA.collapsible_section,
-            name: 'sourcehost',
-            label: IPA.messages.objects.hbacrule.sourcehost,
-            widgets: [
-                {
-                    factory: IPA.rule_details_widget,
-                    name: 'rule',
-                    radio_name: 'sourcehostcategory',
-                    options: [
-                        { 'value': 'all', 'label': IPA.messages.objects.hbacrule.any_host },
-                        { 'value': '', 'label': IPA.messages.objects.hbacrule.specified_hosts }
-                    ],
-                    tables: [
-                        { 'name': 'sourcehost_host' },
-                        { 'name': 'sourcehost_hostgroup' }
-                    ],
-                    widgets: [
-                        {
-                            type: 'rule_association_table',
-                            id: entity_name+'-memberuser_user',
-                            name: 'sourcehost_host',
-                            add_method: 'add_sourcehost',
-                            remove_method: 'remove_sourcehost',
-                            add_title: IPA.messages.association.add.sourcehost,
-                            remove_title: IPA.messages.association.remove.sourcehost
-                        },
-                        {
-                            type: 'rule_association_table',
-                            id: entity_name+'-memberuser_group',
-                            name: 'sourcehost_hostgroup',
-                            add_method: 'add_sourcehost',
-                            remove_method: 'remove_sourcehost',
-                            add_title: IPA.messages.association.add.sourcehost,
-                            remove_title: IPA.messages.association.remove.sourcehost
-                        }
-                    ]
-                }
-            ]
-        }
-    );
-
     var that = IPA.details_facet(spec);
 
     that.update_on_success = function(data, text_status, xhr) {
diff --git a/install/ui/hbactest.js b/install/ui/hbactest.js
index 93d17c7194ccfc4e52f5849e1ef5db095a078b14..6e6861abae9200516361cf0e23eabb1c8c939516 100644
--- a/install/ui/hbactest.js
+++ b/install/ui/hbactest.js
@@ -87,23 +87,6 @@ IPA.hbac.test_entity = function(spec) {
             ]
         }).
         facet({
-            factory: IPA.hbac.test_select_facet,
-            name: 'sourcehost',
-            label: IPA.messages.objects.hbacrule.sourcehost,
-            managed_entity: 'host',
-            disable_breadcrumb: true,
-            facet_group: 'default',
-            columns: [
-                'fqdn',
-                'description',
-                {
-                    name: 'has_keytab',
-                    label: IPA.messages.objects.host.enrolled,
-                    formatter: IPA.boolean_formatter()
-                }
-            ]
-        }).
-        facet({
             factory: IPA.hbac.test_rules_facet,
             name: 'rules',
             label: IPA.messages.objects.hbactest.rules,
@@ -646,9 +629,6 @@ IPA.hbac.test_run_facet = function(spec) {
         facet = that.entity.get_facet('service');
         facet.reset();
 
-        facet = that.entity.get_facet('sourcehost');
-        facet.reset();
-
         facet = that.entity.get_facet('rules');
         facet.reset();
 
@@ -705,10 +685,6 @@ IPA.hbac.test_run_facet = function(spec) {
         facet.save(options);
         that.validate_facet(facet, options, validation_results);
 
-        facet = that.entity.get_facet('sourcehost');
-        facet.save(options);
-        that.validate_facet(facet, options, validation_results);
-
         if (!validation_results.valid) {
             var dialog = IPA.hbac.validation_dialog({
                 validation_results: validation_results
diff --git a/ipalib/plugins/internal.py b/ipalib/plugins/internal.py
index cfb5d60f9f8a9f748b58dd8364a8690bf6724755..3c313b0ec58fad037ebbecefca8b9cdbe30baa10 100644
--- a/ipalib/plugins/internal.py
+++ b/ipalib/plugins/internal.py
@@ -164,7 +164,6 @@ class i18n_messages(Command):
                 "memberallowcmd": _("Add Allow ${other_entity} into ${entity} ${primary_key}"),
                 "memberdenycmd": _("Add Deny ${other_entity} into ${entity} ${primary_key}"),
                 "memberof": _("Add ${entity} ${primary_key} into ${other_entity}"),
-                "sourcehost": _("Add Source ${other_entity} into ${entity} ${primary_key}"),
             },
             "added": _("Items added"),
             "direct_membership": _("Direct Membership"),
@@ -179,7 +178,6 @@ class i18n_messages(Command):
                 "memberallowcmd": _("Remove Allow ${other_entity} from ${entity} ${primary_key}"),
                 "memberdenycmd": _("Remove Deny ${other_entity} from ${entity} ${primary_key}"),
                 "memberof": _("Remove ${entity} ${primary_key} from ${other_entity}"),
-                "sourcehost": _("Remove Source ${other_entity} from ${entity} ${primary_key}"),
             },
             "removed": _("Items removed"),
             "show_results": _("Show Results"),
@@ -425,7 +423,6 @@ class i18n_messages(Command):
                 "host": _("Accessing"),
                 "ipaenabledflag": _("Rule status"),
                 "service": _("Via Service"),
-                "sourcehost": _("From"),
                 "specified_hosts": _("Specified Hosts and Groups"),
                 "specified_services": _("Specified Services and Groups"),
                 "specified_users": _("Specified Users and Groups"),
-- 
1.8.3.1

