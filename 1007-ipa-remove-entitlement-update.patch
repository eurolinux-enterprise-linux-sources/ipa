From 882203f5e7f8494de11b2bf8b91de4e35fabb0ef Mon Sep 17 00:00:00 2001
From: Rob Crittenden <rcritten@redhat.com>
Date: Thu, 30 Aug 2012 10:59:08 -0400
Subject: [PATCH] Add an update to remove existing entitlement
 roles/permissions/privileges

---
 install/updates/50-remove-entitlements.update | 25 +++++++++++++++++++++++++
 install/updates/Makefile.am                   |  1 +
 2 files changed, 26 insertions(+)
 create mode 100644 install/updates/50-remove-entitlements.update

diff --git a/install/updates/50-remove-entitlements.update b/install/updates/50-remove-entitlements.update
new file mode 100644
index 0000000000000000000000000000000000000000..f6cda4085f930e8e9626c3ea98ab609eb92ff98d
--- /dev/null
+++ b/install/updates/50-remove-entitlements.update
@@ -0,0 +1,25 @@
+dn: $SUFFIX
+remove: aci: '(target = "ldap:///ipaentitlementid=*,cn=entitlements,cn=etc,$SUFFIX")(version 3.0;acl "permission:Register Entitlements";allow (add) groupdn = "ldap:///cn=Register Entitlements,cn=permissions,cn=pbac,$SUFFIX";)'
+remove: aci: '(targetattr = "usercertificate")(target = "ldap:///ipaentitlement=*,cn=entitlements,cn=etc,$SUFFIX")(version 3.0;acl "permission:Write Entitlements";allow (write) groupdn = "ldap:///cn=Write Entitlements,cn=permissions,cn=pbac,$SUFFIX";)'
+remove: aci: '(targetattr = "userpkcs12")(target = "ldap:///ipaentitlementid=*,cn=entitlements,cn=etc,$SUFFIX")(version 3.0;acl "permission:Read Entitlements";allow (read) groupdn = "ldap:///cn=Read Entitlements,cn=permissions,cn=pbac,$SUFFIX";)'
+
+dn: cn=Entitlement Management,cn=roles,cn=accounts,$SUFFIX
+deleteentry: dn: cn=Entitlement Management,cn=roles,cn=accounts,$SUFFIX
+
+dn: cn=Entitlement Compliance,cn=roles,cn=accounts,$SUFFIX
+deleteentry: dn: cn=Entitlement Compliance,cn=roles,cn=accounts,$SUFFIX
+
+dn: cn=Register and Write Entitlements,cn=privileges,cn=pbac,$SUFFIX
+deleteentry: dn: cn=Entitlement Compliance,cn=roles,cn=accounts,$SUFFIX
+
+dn: cn=Read Entitlements,cn=privileges,cn=pbac,$SUFFIX
+deleteentry: dn: cn=Entitlement Compliance,cn=roles,cn=accounts,$SUFFIX
+
+dn: cn=Register Entitlements,cn=permissions,cn=pbac,$SUFFIX
+deleteentry: dn: cn=Register Entitlements,cn=permissions,cn=pbac,$SUFFIX
+
+dn: cn=Read Entitlements,cn=permissions,cn=pbac,$SUFFIX
+deleteentry: dn: cn=Read Entitlements,cn=permissions,cn=pbac,$SUFFIX
+
+dn: cn=Write Entitlements,cn=permissions,cn=pbac,$SUFFIX
+deleteentry: dn: cn=Write Entitlements,cn=permissions,cn=pbac,$SUFFIX
diff --git a/install/updates/Makefile.am b/install/updates/Makefile.am
index e9dce7006328d427b975ed0d24a5d0a6968af33c..23da6d52a1718d00afd5467e0e0d7ed06066e436 100644
--- a/install/updates/Makefile.am
+++ b/install/updates/Makefile.am
@@ -36,6 +36,7 @@ app_DATA =				\
 	50-hbacservice.update		\
 	50-nis.update			\
 	50-ipaconfig.update		\
+	50-remove-entitlements.update	\
 	55-pbacmemberof.update		\
 	60-trusts.update		\
 	61-trusts-s4u2proxy.update	\
-- 
2.6.4

