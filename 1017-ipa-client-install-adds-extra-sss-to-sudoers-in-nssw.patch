From 6b9e55ccf6ac52fe7f1f04a3a174b325624573de Mon Sep 17 00:00:00 2001
From: Petr Vobornik <pvoborni@redhat.com>
Date: Wed, 4 Mar 2015 12:59:39 +0100
Subject: [PATCH] ipa-client-install adds extra sss to sudoers in nsswitch.conf

https://bugzilla.redhat.com/show_bug.cgi?id=1198339
---
 ipa-client/ipa-install/ipa-client-install | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

diff --git a/ipa-client/ipa-install/ipa-client-install b/ipa-client/ipa-install/ipa-client-install
index c37383e0d1af07e1d27250ee0d8d80695582b028..04d5d12359a999b030f3121e762d9875c139affe 100755
--- a/ipa-client/ipa-install/ipa-client-install
+++ b/ipa-client/ipa-install/ipa-client-install
@@ -358,10 +358,16 @@ def configure_nsswitch_database(fstore, database, services, preserve=True,
             else:
                 configured_services = raw_database_entry['value'].strip()

+        # Make sure no service is added if already mentioned in the list
+        added_services = [s for s in services
+                          if s not in configured_services]
+
         if append:
-            new_services = ' ' + configured_services + ' ' + ' '.join(services)
+            new_services = (' ' + configured_services + ' ' +
+                           ' '.join(added_services))
         else:
-            new_services = ' ' +  ' '.join(services) + ' ' + configured_services
+            new_services = (' ' +  ' '.join(added_services) +
+                           ' ' + configured_services)

     else:
         # Preserve not set, let's rewrite existing configuration
--
2.1.0

