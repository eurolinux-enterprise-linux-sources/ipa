From 4b9754aafca1530b76504cedf361fa280a088113 Mon Sep 17 00:00:00 2001
From: Petr Vobornik <pvoborni@redhat.com>
Date: Wed, 4 Mar 2015 12:59:39 +0100
Subject: [PATCH] ipa-client-install adds extra sss to sudoers in nsswitch.conf

https://bugzilla.redhat.com/show_bug.cgi?id=1198339
---
 ipa-client/ipa-install/ipa-client-install | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

diff --git a/ipa-client/ipa-install/ipa-client-install b/ipa-client/ipa-install/ipa-client-install
index 21e3b84ac78929dea2fa3af57829f79b5c608e8c..a73a26c166883a4301e4d53518cd4ea27fd6df16 100755
--- a/ipa-client/ipa-install/ipa-client-install
+++ b/ipa-client/ipa-install/ipa-client-install
@@ -358,10 +358,16 @@ def configure_nsswitch_database(fstore, database, services, preserve=True,
             else:
                 configured_services = raw_database_entry['value'].strip()
 
+        # Make sure no service is added if already mentioned in the list
+        added_services = [s for s in services
+                          if s not in configured_services]
+
         if append:
-            new_services = ' ' + configured_services + ' ' + ' '.join(services)
+            new_services = (' ' + configured_services + ' ' +
+                           ' '.join(added_services))
         else:
-            new_services = ' ' +  ' '.join(services) + ' ' + configured_services
+            new_services = (' ' +  ' '.join(added_services) +
+                           ' ' + configured_services)
 
     else:
         # Preserve not set, let's rewrite existing configuration
-- 
2.4.3

